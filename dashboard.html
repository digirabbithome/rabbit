
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Rabbithome 後台</title>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore-compat.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; }
    aside { width: 200px; background: #2e7eff; color: white; padding: 20px; }
    main { flex-grow: 1; background: #f0f4ff; padding: 40px; }
    button { padding: 10px 20px; background-color: #2e7eff; color: white; border: none; border-radius: 5px; margin-top: 10px; }
    .log { margin-top: 20px; font-size: 16px; }
    #logList { background: white; padding: 10px; border-radius: 5px; margin-top: 10px; }
  </style>
</head>
<body>
  <aside>
    <h2>功能選單</h2>
    <p>🕒 每日打卡</p>
    <button onclick="loadStatus()">🔄 重新載入</button>
  </aside>
  <main>
    <h1>🎯 今日工作日誌</h1>
    <p>請於 10:00 前點擊完成：</p>
    <button onclick="markDone()">✅ 完成工作</button>
    <div class="log" id="statusLog">載入中...</div>
    <div id="logList"></div>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyANuDJyJuQbxnXq-FTyaTAI9mSc6zpmuWs",
      authDomain: "rabbithome-auth.firebaseapp.com",
      projectId: "rabbithome-auth",
      storageBucket: "rabbithome-auth.firebasestorage.app",
      messagingSenderId: "50928677930",
      appId: "1:50928677930:web:e8eff13c8028b888537f53"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let userEmail = "";

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        userEmail = user.email;
        loadStatus();
        setInterval(loadStatus, 10000); // 每 10 秒更新一次
      } else {
        window.location.href = "index.html";
      }
    });

    function markDone() {
      const now = new Date();
      const today = now.toISOString().split("T")[0];
      db.collection("worklog").add({
        user: userEmail,
        date: today,
        time: now.toLocaleTimeString("zh-TW", { hour12: false })
      }).then(loadStatus);
    }

    function loadStatus() {
      const today = new Date().toISOString().split("T")[0];
      document.getElementById("statusLog").textContent = `📅 今日紀錄 (${today})`;
      db.collection("worklog")
        .where("date", "==", today)
        .orderBy("time")
        .get()
        .then(snapshot => {
          const log = snapshot.docs.map(doc => {
            const d = doc.data();
            return `✔️ ${d.user} 在 ${d.time} 完成`;
          }).join("<br>");
          document.getElementById("logList").innerHTML = log || "尚無人完成";
        });
    }
  </script>
</body>
</html>
